<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-03-09
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20140309" />
    <meta http-equiv="Content-Language" content="en" />
    <title>everest - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<link rel="stylesheet" href="css/site.css" type="text/css"/>
                      
        
<link rel="stylesheet" href="css/bootstrap.css" type="text/css"/>
                      
        
<link rel="stylesheet" href="css/custom.css" type="text/css"/>
                      
        
<link rel="stylesheet" href="css/fonts.css" type="text/css"/>
                      
        
<link rel="stylesheet" href="css/color_schemes.css" type="text/css"/>
          
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/99soft/backport-spi">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="#" id="bannerLeft">
                                                                                                <img src=""  alt="OW2 Chameleon - OSGi Testing Helpers"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-03-09</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.6.2</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">OSGi Test Helpers</li>
                                
      <li class="active">
    
            <a href="#"><i class="none"></i>Documentation</a>
          </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>OSGi Helpers</h1><p>The OSGi Helper project is a pretty simple library providing useful methods for OSGi integration-tests. The goal is to help the writing of OSGi tests by avoiding the burden of the regular OSGi API. For example, instead of always relying on the bundle context to get a service, the OSGi helper provides a ‘getServiceObject’ method.</p><p>The OSGi helper library does not only contain OSGi specific method, but also support iPOJO and provides an extensible mechanism to add others helpers.</p><p>Using the OSGi Helper Library with OPS4J Pax Exam First, you need to add the OSGi helper library in your class path. For Maven, it looks like:</p>
<pre><code class="xml">    &lt;dependency&gt;
        &lt;groupId&gt;org.ow2.chameleon.testing&lt;/groupId&gt;
        &lt;artifactId&gt;osgi-helpers&lt;/artifactId&gt;
        &lt;version&gt;0.6.2&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre><p>Then, helper objects are initialized in the <code>@Before</code> and disposed in the <code>@After</code> methods. Disposing helpers cleans all the resources used by the helper (service references, instances…). You also need to deploy the library as an OSGi bundle. So, your test class should contain something like:</p>
<pre><code class="java">    @Inject
    private BundleContext context;
    private OSGiHelper osgi;
    private IPOJOHelper ipojo;

    @Configuration
    public static Option[] configure() throws Exception {
        Option[] opt = CoreOptions.options(
            CoreOptions.felix(),
            CoreOptions.provision(
              CoreOptions.mavenBundle()
                 .groupId(&quot;org.apache.felix&quot;)
                .artifactId(&quot;org.apache.felix.ipojo&quot;)
                .versionAsInProject(),
              CoreOptions.mavenBundle()
               .groupId(&quot;org.ow2.chameleon.testing&quot;)
               .artifactId(&quot;osgi-helpers&quot;)
               .versionAsInProject()
             // …
      )
       );
        return opt;
    }

    @Before
    public void setup() {
        osgi = new OSGiHelper(context);
        ipojo = new IPOJOHelper(context);
    }

    @After
    public void tearDown() {
        osgi.dispose();
        ipojo.dispose();
    }
</code></pre><p>Then, the osgi and ipojo members give you access to the tests methods. Note, that they can be used separately.</p>
<pre><code class="java">    @Test
    public void testMemWriter() throws Exception {
        // Create the instance
        Properties props = new Properties();
        props.put(FeedWriter.FEED_TITLE_PROPERTY, &quot;a feed&quot;);
        ipojo
           .createComponentInstance(
              &quot;org.ow2.chameleon.syndication.rome.memwriter&quot;,
               props);
        osgi.waitForService(FeedWriter.class.getName(), null, 5000);

        ServiceReference ref = osgi
              .getServiceReference(FeedReader.class.getName());
        // ...

        FeedWriter writer = (FeedWriter) osgi
              .getServiceObject(FeedWriter.class.getName(), null);

       //…
    }
</code></pre><p>The complete API is available <a href="apidocs/index.html">here</a></p>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2009-2014
                        <a href="http://ow2.org">OW2 Chameleon</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
